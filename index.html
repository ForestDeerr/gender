<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Гендер Тотализатор</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #ffe0f0, #e0f0ff);
      margin: 0;
      padding: 2rem;
      color: #444;
    }

    h1 {
      text-align: center;
      color: #d63384;
    }

    form {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 2rem;
    }

    input, select, button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    button {
      background-color: #d63384;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    button:hover {
      background-color: #c2186a;
    }

    .bet-list {
      max-width: 600px;
      margin: auto;
    }

    .bet-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fff0f5;
      border: 1px solid #ffc0cb;
      padding: 0.8rem 1rem;
      border-radius: 10px;
      margin-bottom: 0.5rem;
    }

    .bet-item span {
      font-weight: bold;
    }

    .delete-btn {
      background-color: #74c0fc;
      color: #fff;
      border: none;
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      cursor: pointer;
    }

    .delete-btn:hover {
      background-color: #339af0;
    }

    .bank-info {
      text-align: center;
      margin-top: 2rem;
      font-size: 1.2rem;
      color: #d63384;
    }
  </style>
</head>
<body>
  <h1>Гендер Тотализатор</h1>

  <form id="bet-form">
    <input type="text" id="name" placeholder="Ваше имя" required>
    <select id="choice">
      <option value="м">Мальчик</option>
      <option value="ж">Девочка</option>
      <option value="двойня">Двойня</option>
    </select>
    <button type="submit">Сделать ставку (5₽)</button>
  </form>

  <div class="bet-list" id="bet-list"></div>

  <!-- Информация о банке и призовом фонде -->
  <div class="bank-info">
    <p>Общий банк: <span id="total-bank">0₽</span></p>
    <p>Призовой фонд (50%): <span id="prize-fund">0₽</span></p>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-database-compat.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBrvZ9tZD5M-n3X-2lJXyV6C_qK4w4TLMQ",
      authDomain: "forest-8fcf9.firebaseapp.com",
      projectId: "forest-8fcf9",
      storageBucket: "forest-8fcf9.appspot.com",
      messagingSenderId: "435012597352",
      appId: "1:435012597352:web:e5a5534e0646891194addd",
      measurementId: "G-5GQHJ7NJBF",
      databaseURL: "https://forest-8fcf9-default-rtdb.firebaseio.com"  // Обновленный URL
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const form = document.getElementById('bet-form');
    const list = document.getElementById('bet-list');
    const totalBankElement = document.getElementById('total-bank');
    const prizeFundElement = document.getElementById('prize-fund');

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      const choice = document.getElementById('choice').value;
      if (!name) return;

      const bet = { name, choice, amount: 5 };  // Ставка 5₽
      db.ref("bets").push(bet).then(() => {
        form.reset();
        loadBets();
      });
    });

    function loadBets() {
      db.ref("bets").once("value").then(snapshot => {
        const data = snapshot.val() || {};
        const grouped = {};
        let totalBank = 0;

        Object.entries(data).forEach(([id, bet]) => {
          console.log(`Bet loaded: ${bet.name} → ${bet.choice} (5₽)`);  // Логирование ставок
          const key = bet.name + "-" + bet.choice;
          if (!grouped[key]) {
            grouped[key] = { ...bet, count: 0, ids: [] };
          }
          grouped[key].count += 1;
          grouped[key].ids.push(id);
          totalBank += bet.amount;
        });

        // Логируем общий банк
        console.log(`Total bank: ${totalBank}`);

        // Если есть ставки, то отображаем их
        list.replaceChildren();
        Object.values(grouped).forEach(bet => {
          const div = document.createElement('div');
          div.className = 'bet-item';
          div.innerHTML = `
            <span>${bet.name} → ${bet.choice} × ${bet.count}</span>
            <button class="delete-btn">Удалить</button>
          `;
          div.querySelector('button').addEventListener('click', () => {
            const updates = {};
            bet.ids.forEach(id => updates[id] = null);
            db.ref("bets").update(updates).then(loadBets);
          });
          list.appendChild(div);
        });

        // Обновление информации о банке и призовом фонде
        totalBankElement.textContent = `${totalBank}₽`;
        const prizeFund = totalBank * 0.5;
        prizeFundElement.textContent = `${prizeFund}₽`;
      }).catch(error => {
        console.error('Error loading bets:', error);
      });
    }

    loadBets();
  </script>
</body>
</html>
